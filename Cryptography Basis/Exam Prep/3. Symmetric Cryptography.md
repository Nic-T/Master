# Symmetric Cryptography

This phase covers algorithms where the same key is used for both encryption and decryption. The security of these systems relies entirely on keeping the key secret and the randomness of the key

## Stream Ciphers

### 1. Mechanism

- Encrypts data one bit or one byte at a time
- They tread data like a continous stream

### 2. The Math

- THey rely almost exclusively on the XOR function.
- **Encryption:** Plaintext ⊕ Keystream = Ciphertext
- **Decryption:** Ciphertext ⊕ Keystream = Plaintext

### 3. Keystream Generator

- The Security depends on the "Keystream Generator" (often a PRNG), that expands a short secret key into a long, pseudo-random stream of bits

### 4. Examples

- **One-Time Pad (OTP):** The only theoretically unbreakable cipher
- **RC4:** Used in WEP and SSL
- **A5/1:** Used to encrypt GSM mobile phone conversations

## Block Ciphers

### 1. Mechanism

- Breaks the plaintext into fixed-size chunhs (64 or 128 bits) and encrypts each block as a unit

### 2. Padding

Block ciphers require input to be an exact multiple of the block size. If the plaintext doesn't fit perfectly, padding bytes must be added to fill the last block.

#### PKCS#7 Padding (Most Common)

- **How it works:** Each padding byte contains the value of the number of padding bytes added.
- **Example (8-byte block):**
  - Message: `HELLO` (5 bytes) → needs 3 bytes of padding
  - Padded: `HELLO\x03\x03\x03` (each pad byte = 0x03)
  - Message: `HI` (2 bytes) → needs 6 bytes of padding
  - Padded: `HI\x06\x06\x06\x06\x06\x06`
- **Full block case:** If the message is already a perfect multiple, add a full block of padding (e.g., 8 bytes of `\x08`). This ensures unambiguous removal.
- **Removal:** Read the last byte's value (n), then remove the last n bytes.

#### Other Padding Schemes

- **Zero Padding:** Pad with `\x00` bytes. Problem: ambiguous if message ends with zeros.
- **ANSI X.923:** Pad with zeros, but the last byte is the count (e.g., `\x00\x00\x03`).
- **ISO/IEC 7816-4:** Pad with `\x80` followed by zeros (`\x80\x00\x00`).

#### Why Padding Matters for Security

- Incorrect padding validation leads to vulnerabilities like the **Padding Oracle Attack** (see CBC mode).
- Modern authenticated encryption modes (like GCM) avoid padding entirely.

### 3. Architecture

- Most block ciphers are built using Product Ciphers
- 1. **Confusion:** Obscures the relationship between the key and the ciphertext (achieved via Substitution or S-boxes)
- 2. **Diffusion:** Spreads the influence of one plaintexxt over many ciphertext bits (achieved via Transportation/Permutation or P-boxes)

## Core Architectures

### 1. Feistel Networks

- used by DES
- the block is split into two halves (Left and Right)
- The Right half is processed with the key and XORed with the Left half.
- The halves are swapped
- THis makes encryption and decryption structurally identical

### 2. SPN(Substitution-Permutation Network)

- used by AES
- Applies rounds of substitution (S-boxes) and permutation (shifting rows/mixing columns) to the entire block in parallel, rather than splitting

### 3. The Algorithms (DES vs. AES)

| Feature           | DES (Data Encryption Standard)                                                                                                         | AES (Advanced Encryption Standard)                                |
| :---------------- | :------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------- |
| **Status**        | Deprecated / Legacy                                                                                                                    | Current Standard                                                  |
| **Block Size**    | 64 bits                                                                                                                                | 128 bits                                                          |
| **Key Size**      | 56 bits (too short for modern safety)                                                                                                  | 128, 192, or 256 bits                                             |
| **Structure**     | Feistel Network (16 rounds)                                                                                                            | SPN (10, 12, or 14 rounds)                                        |
| **Vulnerability** | Vulnerable to brute-force attacks .                                                                                                    | Secure against brute-force; mathematical attacks are theoretical. |
| **Variant**       | **3DES (Triple DES):** Runs DES 3 times ($Encrypt \rightarrow Decrypt \rightarrow Encrypt$) to fix key length issues. Slow but secure. | **Rijndael:** The algorithm selected by NIST to become AES .      |

### 4. Modes of Operation

A block cipher only encrypts one block. To encrypt a file, you need a "Mode of Operation." This is a critical exam topic.

#### 1. ECB (Electronic Codebook)

- **How it works:** Encrypts each block independently with the same key.
- **Pros:** Parallelizable (very fast), errors do not propagate to other blocks.
- **Cons:** Pattern Leakage. Identical plaintext blocks produce identical ciphertext blocks. (e.g., The famous "Penguin" image remains visible even after encryption).
- **Use Case:** Only for very small, random data (like keys), never for files or images.

#### 2. CBC (Cipher Block Chaining)

- **How it works:** The "standard" mode. It XORs the current plaintext block with the previous ciphertext block before encryption.
- **IV (Initialization Vector):** Required for the first block (since there is no previous ciphertext). The IV must be random but not secret.
- **Pros:** Hides patterns (identical inputs produce different outputs).
- **Cons:** Sequential (cannot parallelize encryption), requires padding.
- **Vulnerability - Padding Oracle Attack:**
  - **Target:** Specifically attacks CBC mode implementations that use padding (like PKCS#7).
  - **Mechanism:** It exploits the server's error messages. In CBC, the plaintext is recovered by XORing the decrypted block with the previous ciphertext block ($P_i = D_k(C_i) \oplus C_{i-1}$).
  - **The Attack:** An attacker can manipulate the bits of the previous ciphertext block ($C_{i-1}$) and send it to the server. If the server returns a "Padding Error," the attacker knows the guess was wrong. If it returns a different error (or no error), the attacker knows they successfully produced valid padding, allowing them to decrypt the message byte-by-byte without the key.
  - **Defense:** Use authenticated encryption (like GCM), or ensure error messages don't leak padding validity.

#### 3. CTR (Counter Mode)

- **How it works:** Turns a block cipher into a stream cipher. It encrypts a "counter" value (Nonce + Counter) to generate a keystream, which is XORed with the plaintext.
- **Pros:** Parallelizable, no padding required, pre-computable keystream.
- **Cons:** You must never reuse a Key+Counter pair (nonce reuse catastrophic).

#### 4. Feedback Modes (CFB & OFB)

- **CFB (Cipher Feedback):** Turns a block cipher into a self-synchronizing stream cipher.
- **OFB (Output Feedback):** Turns a block cipher into a synchronous stream cipher. Errors do not propagate, but loss of synchronization is fatal.

## Building Blocks of Block Ciphers

These components are combined to create Product Ciphers (like DES or AES) that achieve both "Confusion" (obscuring the relationship between key and ciphertext) and "Diffusion" (spreading the influence of plaintext bits).

### 1. S-Boxes (Substitution Boxes)

- **Definition:** These perform Substitution. They replace a small block of bits (input) with a different block of bits (output) based on a lookup table.
- **Role:** They provide Confusion and are the only non-linear part of most block ciphers (meaning the output cannot be simply calculated as a linear sum of inputs).
- **In AES:** The S-box replaces each byte with a new byte derived from a mathematical transformation (multiplicative inverse) in a Finite Field.

### 2. P-Boxes (Permutation Boxes)

- **Definition:** These perform Transposition (or Permutation). They simply rearrange (shuffle) the bits without changing their values (0s stay 0s, 1s stay 1s).
- **Role:** They provide Diffusion, ensuring that if you change one bit of the input, it affects many bits in the subsequent rounds.

## AES Specific Operations

AES does not use a raw "P-box" like the older DES algorithm. Instead, it achieves diffusion using two mathematical steps:

### 1. ShiftRows

- **Definition:** A simple transposition step. It treats the 128-bit data block as a 4x4 grid of bytes. It cyclically shifts the rows to the left: Row 0 is not shifted, Row 1 shifts 1 byte, Row 2 shifts 2 bytes, etc.
- **Goal:** To mix the data linearly across the columns.

### 2. MixColumns

- **Definition:** A mathematical transformation where each column of the 4x4 data grid is multiplied by a fixed matrix.
- **Goal:** To mix the data vertically. Combined with ShiftRows, this ensures that after a few rounds, every bit of the output depends on every bit of the input (the "Avalanche Effect").

## The Math Behind AES

The sources emphasize that you don't need standard algebra, but rather Finite Field Mathematics (specifically Galois Fields).

### 1. Finite Fields (GF(2⁸))

- AES treats bytes not just as numbers (0-255), but as polynomials. For example, the byte `1011` corresponds to the polynomial $x^3 + x + 1$.
- All operations (add, multiply) are performed within this field. If a calculation results in a number larger than 8 bits, it "wraps around" using a specific prime polynomial (reduction modulo P(x)).

### 2. XOR (Addition)

- In cryptography, "adding" two numbers usually means XORing them. In the context of Finite Fields, XOR is equivalent to polynomial addition.

### 3. Matrix Multiplication

- The MixColumns step uses matrix multiplication. You multiply the state matrix by a constant matrix. However, the multiplication and addition inside this matrix operation follow the rules of the Finite Field described above, not standard arithmetic.
